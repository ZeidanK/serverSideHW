<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
            crossorigin="anonymous"></script>
    <title></title>
</head>
<body>

    <script>
        function ajaxCall(method, api, data, successCB, errorCB) {
            $.ajax({
            type: method,
            url: api,
            data: data,
            cache: false,
            contentType: "application/json",
            dataType: "json",
            success: successCB,
            error: errorCB
            });
        }

        // Function to fetch movies data from the external source
        function fetchMoviesFromUrl() {
            // Due to CORS restrictions, this direct AJAX call may not work
            ajaxCall(
            "GET", 
            "https://moodle.ruppin.ac.il/pluginfile.php/352418/mod_resource/content/1/movies.js",
            {},
            function(data) {
                // Success callback
                if (data && data.movies) {
                displayMovies(data.movies);
                } else {
                displayMovies(data);
                }
            },
            function(error) {
                // Error callback - CORS error likely
                console.error("AJAX call failed:", error);
                
                // Alternative: Load the script via a script tag
                const script = document.createElement('script');
                script.src = "https://moodle.ruppin.ac.il/pluginfile.php/352418/mod_resource/content/1/movies.js";
                script.onload = function() {
                // Once loaded, 'movies' variable should be available in global scope
                if (typeof movies !== 'undefined') {
                    displayMovies(movies);
                } else {
                    $('#movies-container').html('<p>Failed to load movies data.</p>');
                }
                };
                script.onerror = function() {
                $('#movies-container').html('<p>Failed to load movies data.</p>');
                };
                document.head.appendChild(script);
            }
            );
        }

        $(document).ready(function () {
            // Call the function to fetch movies when document is ready
            fetchMoviesFromUrl();
        });

        // Function to display the movies in the DOM
        function displayMovies(moviesData) {
            // Create a container if it doesn't exist
            if ($('#movies-container').length === 0) {
            $('body').append('<div id="movies-container"></div>');
            }
            
            // Clear any existing content
            $('#movies-container').empty();
            
            // Check if we have movies to display
            if (!moviesData || moviesData.length === 0) {
            $('#movies-container').html('<p>No movies available.</p>');
            return;
            }
            
            // Create a list to display the movies
            const moviesList = $('<ul></ul>');
            
            // Loop through the movies and add them to the list
            $.each(moviesData, function(index, movie) {
            const movieItem = $('<li></li>');
            movieItem.append(`<h3>${movie.title || 'Unknown Title'}</h3>`);
            
            if (movie.year) {
                movieItem.append(`<p>Year: ${movie.year}</p>`);
            }
            
            if (movie.director) {
                movieItem.append(`<p>Director: ${movie.director}</p>`);
            }
            
            moviesList.append(movieItem);
            });
            
            // Add the list to the container
            $('#movies-container').append(moviesList);
        }
    </script>
</body>
</html>